unit uODACDatabase;

interface

uses
  SysUtils, Classes, DB, Ora, OraSmart, IniFiles;

type
  TDatabase = class
  private
    class var FOraSession: TOraSession;
  public
    class function GetSession: TOraSession;
    class procedure Connect;
  end;

implementation

class procedure TDatabase.Connect;
var
  Ini: TIniFile;
  Host, User, Password, DB: string;
begin
  Ini := TIniFile.Create(ExtractFilePath(ParamStr(0)) + 'config.ini');
  try
    Host := Ini.ReadString('database', 'host', '');
    User := Ini.ReadString('database', 'user', '');
    Password := Ini.ReadString('database', 'password', '');
    DB := Ini.ReadString('database', 'service_name', '');
  finally
    Ini.Free;
  end;

  FOraSession := TOraSession.Create(nil);
  FOraSession.Username := User;
  FOraSession.Password := Password;
  FOraSession.Server := Host + '/' + DB;
  FOraSession.LoginPrompt := False;
  FOraSession.Connected := True;
end;

class function TDatabase.GetSession: TOraSession;
begin
  if FOraSession = nil then
    Connect;
  Result := FOraSession;
end;

end.
